<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Database-Backed Data Provider db-data-provider%</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-fonts.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Database-<wbr></wbr>Backed Data Provider db-<wbr></wbr>data-<wbr></wbr>provider%</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Data_.Model%29" class="tocviewlink" data-pltdoc="x">Data Model</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Class_db-data-provider_%29" class="tocviewlink" data-pltdoc="x">Class db-<wbr></wbr>data-<wbr></wbr>provider%</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.Connection_.Handling%29" class="tocviewlink" data-pltdoc="x">Connection Handling</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._.Stop_.Handling%29" class="tocviewlink" data-pltdoc="x">Stop Handling</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="#%28part._.Route_.Handling%29" class="tocviewlink" data-pltdoc="x">Route Handling</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="#%28part._.Route_.Update_.Handling%29" class="tocviewlink" data-pltdoc="x">Route Update Handling</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="#%28part._.Food_.Places%29" class="tocviewlink" data-pltdoc="x">Food Places</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="#%28part._.File_.Structure%29" class="tocviewlink" data-pltdoc="x">File Structure</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._db-data-provider%29" class="tocsubseclink" data-pltdoc="x">Database-<wbr></wbr>Backed Data Provider db-<wbr></wbr>data-<wbr></wbr>provider%</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Data_.Model%29" class="tocsubseclink" data-pltdoc="x">Data Model</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Class_db-data-provider_%29" class="tocsubseclink" data-pltdoc="x">Class db-<wbr></wbr>data-<wbr></wbr>provider%</a></td></tr><tr><td><a href="#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdb-data-provider..rkt._db-data-provider~25%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">db-<wbr></wbr>data-<wbr></wbr>provider%</span></a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cdb-data-provider~25~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;db-data-provider%&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.Connection_.Handling%29" class="tocsubseclink" data-pltdoc="x">Connection Handling</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cconnection-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;connection-handling&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.Stop_.Handling%29" class="tocsubseclink" data-pltdoc="x">Stop Handling</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cstop-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stop-handling&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._.Stops_.Caching%29" class="tocsubseclink" data-pltdoc="x">Stops Caching</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cstops-caching~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stops-caching&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">4.2<tt>&nbsp;</tt></span><a href="#%28part._query-all-stops%29" class="tocsubseclink" data-pltdoc="x">Query All Stops</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cstops-select-statement~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stops-select-statement&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cstops~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stops&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cstops-by-id~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stops-by-id&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._.Route_.Handling%29" class="tocsubseclink" data-pltdoc="x">Route Handling</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3croute-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-handling&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">5.1<tt>&nbsp;</tt></span><a href="#%28part._.Route_.Caching%29" class="tocsubseclink" data-pltdoc="x">Route Caching</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3croute-caching~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-caching&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">5.2<tt>&nbsp;</tt></span><a href="#%28part._.Route_.Querying%29" class="tocsubseclink" data-pltdoc="x">Route Querying</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3croute-querying~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-querying&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">5.2.1<tt>&nbsp;</tt></span><a href="#%28part._.Query_.All_.Routes%29" class="tocsubseclink" data-pltdoc="x">Query All Routes</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3call-routes~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;all-routes&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">5.2.2<tt>&nbsp;</tt></span><a href="#%28part._.Routes_for_.Stop%29" class="tocsubseclink" data-pltdoc="x">Routes for Stop</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cquery-mapped-routes-statement~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;query-mapped-routes-statement&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3croutes-for-stop-id~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;routes-for-stop-id&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3croutes-for-stop~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;routes-for-stop&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">5.2.3<tt>&nbsp;</tt></span><a href="#%28part._.Does_.Route_.Exist_%29" class="tocsubseclink" data-pltdoc="x">Does Route Exist?</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3croute-exists~3f~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-exists?&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">5.3<tt>&nbsp;</tt></span><a href="#%28part._.Route_.Insertion%29" class="tocsubseclink" data-pltdoc="x">Route Insertion</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3croute-insertion-statement~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-insertion-statement&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cformat-route-data~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;format-route-data&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3croute-insertion~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-insertion&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">5.3.1<tt>&nbsp;</tt></span><a href="#%28part._.Stop_.Insertion_for_.Given_.Route%29" class="tocsubseclink" data-pltdoc="x">Stop Insertion for Given Route</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cget-id-for-route-data-statement~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;get-id-for-route-data-statement&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cinsert-route-stops~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;insert-route-stops&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">6<tt>&nbsp;</tt></span><a href="#%28part._.Route_.Update_.Handling%29" class="tocsubseclink" data-pltdoc="x">Route Update Handling</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3croute-update-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-update-handling&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">6.1<tt>&nbsp;</tt></span><a href="#%28part._.Table_.Checksum%29" class="tocsubseclink" data-pltdoc="x">Table Checksum</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cchecksum~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;checksum&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">6.2<tt>&nbsp;</tt></span><a href="#%28part._.Handle_.Callbacks%29" class="tocsubseclink" data-pltdoc="x">Handle Callbacks</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3ccallback-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;callback-handling&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">6.3<tt>&nbsp;</tt></span><a href="#%28part._.Periodic_.Checksum_.Update%29" class="tocsubseclink" data-pltdoc="x">Periodic Checksum Update</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cperiodic-checksum-checking~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;periodic-checksum-checking&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">7<tt>&nbsp;</tt></span><a href="#%28part._.Food_.Places%29" class="tocsubseclink" data-pltdoc="x">Food Places</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3cfood-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;food-handling&gt;</a></span></td></tr><tr><td><span class="tocsublinknumber">8<tt>&nbsp;</tt></span><a href="#%28part._.File_.Structure%29" class="tocsubseclink" data-pltdoc="x">File Structure</a></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3c%2A~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;*&gt;</a></span></td></tr><tr><td><span class="Smaller"><a href="#%28elem._%28chunk._~3crequires~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;requires&gt;</a></span></td></tr></table></div></div><div class="maincolumn"><div class="main"><h2><a name="(part._db-data-provider)"></a>Database-Backed Data Provider db-data-provider%</h2><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="stt"> </span><span class="RktVal">"db-data-provider.rkt"</span><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/base" title="Install this package using `raco pkg install base`"><span class="stt">base</span></a></span></td></tr></table></p><h3>1<tt>&nbsp;</tt><a name="(part._.Data_.Model)"></a>Data Model</h3><ul><li><p>database is modelled according to the following ER diagram:</p></li><li><p>(note that the food table is not used yet as no restaurant data is needed in task 2)</p></li></ul><p><img src="er-diagram.png" alt="" width="487" height="539"/></p><h3>2<tt>&nbsp;</tt><a name="(part._.Class_db-data-provider_)"></a>Class db-data-provider%</h3><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>class</p></div></div><p class="RForeground"><a name="(def._(c~3a~5cdoc~5csrc~5croute21~5csub3~5cdb-data-provider..rkt._db-data-provider~25))"></a><span title="Provided from: &quot;db-data-provider.rkt&quot; | Package: base"><span class="RktSym"><span class="RktSymDef RktSym">db-data-provider%</span></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/objectutils.html#%28def._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._class~3f%29%29" class="RktValLink" data-pltdoc="x">class?</a></span></p></blockquote></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;</span>superclass:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28def._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._object~25%29%29" class="RktValLink" data-pltdoc="x">object%</a></span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><span class="hspace">&nbsp;&nbsp;</span>extends:<span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="data-provider.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-provider..rkt._data-provider~3c~25~3e%29%29" class="RktValLink" data-pltdoc="x">data-provider&lt;%&gt;</a></span></td></tr></table></td></tr></table></div><div class="SIntrapara">Implements <span class="RktSym"><a href="data-provider.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-provider..rkt._data-provider~3c~25~3e%29%29" class="RktValLink" data-pltdoc="x">data-provider&lt;%&gt;</a></span> via a MySQL database backend:</div><div class="SIntrapara"><ul><li><p>manages a virtual connection pool to the database</p></li><li><p>implements all interface messages via queries on the connection</p></li></ul></div><div class="SIntrapara"><blockquote class="leftindent"></blockquote></div></p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cdb-data-provider~25~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cdb-data-provider~25~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;db-data-provider%&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">db-data-provider%</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._class%2A%29%29" class="RktStxLink" data-pltdoc="x">class*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28def._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._object~25%29%29" class="RktValLink" data-pltdoc="x">object%</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-provider.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-provider..rkt._data-provider~3c~25~3e%29%29" class="RktValLink" data-pltdoc="x">data-provider&lt;%&gt;</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._init%29%29" class="RktStxLink" data-pltdoc="x">init</a></span><span class="hspace">&nbsp;</span><span class="RktSym">server</span><span class="hspace">&nbsp;</span><span class="RktSym">user</span><span class="hspace">&nbsp;</span><span class="RktSym">password</span><span class="hspace">&nbsp;</span><span class="RktSym">database</span><span class="hspace">&nbsp;</span><span class="RktSym">poll-millisecs</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/objcreation.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._super-new%29%29" class="RktStxLink" data-pltdoc="x">super-new</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28elem._%28chunk._~3cconnection-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;connection-handling&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28elem._%28chunk._~3cstop-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stop-handling&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28elem._%28chunk._~3croute-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-handling&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28elem._%28chunk._~3croute-update-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-update-handling&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28elem._%28chunk._~3cfood-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;food-handling&gt;</a><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h3>3<tt>&nbsp;</tt><a name="(part._.Connection_.Handling)"></a>Connection Handling</h3><ul><li><p>virtual connection pool scales to multiple clients and makes this provider usable with, e.g., web-clients</p></li><li><p>see the documentation at <span class="RktSym"><a href="https://docs.racket-lang.org/db/connect.html#%28def._%28%28lib._db%2Fbase..rkt%29._virtual-connection%29%29" class="RktValLink" data-pltdoc="x">virtual-connection</a></span></p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3cconnection-handling~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cconnection-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;connection-handling&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">connection</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/connect.html#%28def._%28%28lib._db%2Fbase..rkt%29._virtual-connection%29%29" class="RktValLink" data-pltdoc="x">virtual-connection</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/connect.html#%28def._%28%28lib._db%2Fbase..rkt%29._connection-pool%29%29" class="RktValLink" data-pltdoc="x">connection-pool</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/connect.html#%28def._%28%28lib._db%2Fmain..rkt%29._mysql-connect%29%29" class="RktValLink" data-pltdoc="x">mysql-connect</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:server</span><span class="hspace">&nbsp;</span><span class="RktSym">server</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:user</span><span class="hspace">&nbsp;</span><span class="RktSym">user</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:password</span><span class="hspace">&nbsp;</span><span class="RktSym">password</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:database</span><span class="hspace">&nbsp;</span><span class="RktSym">database</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h3>4<tt>&nbsp;</tt><a name="(part._.Stop_.Handling)"></a>Stop Handling</h3><p><div class="SIntrapara"><a name="(elem._(chunk._~3cstop-handling~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cstop-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stop-handling&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="#%28elem._%28chunk._~3cstops-caching~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stops-caching&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><a href="#%28elem._%28chunk._~3cstops~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stops&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><a href="#%28elem._%28chunk._~3cstops-by-id~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stops-by-id&gt;</a></td></tr></table></blockquote></div></p><h4>4.1<tt>&nbsp;</tt><a name="(part._.Stops_.Caching)"></a>Stops Caching</h4><ul><li><p>stops never change in the database</p></li><li><p>remember stops in (lazily initialized) top level variable cache</p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3cstops-caching~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cstops-caching~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stops-caching&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">all-stops</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></p></blockquote></div></p><h4>4.2<tt>&nbsp;</tt><a name="(part._query-all-stops)"></a>Query All Stops</h4><p>selected with the following simple SQL statement:</p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cstops-select-statement~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cstops-select-statement~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stops-select-statement&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktVal">"select id,lon,lat,name,alt_name from stop"</span></p></blockquote></div></p><ul><li><p>database layer returns a <span class="RktSym"><a href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector%29%29" class="RktValLink" data-pltdoc="x">vector</a></span> with the queried fields in order</p></li><li><p>convert to <span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._stop%29%29" class="RktValLink" data-pltdoc="x">stop</a></span> structure</p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3cstops~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cstops~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stops&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._define%2Fpublic%29%29" class="RktStxLink" data-pltdoc="x">define/public</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">stops</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._unless%29%29" class="RktStxLink" data-pltdoc="x">unless</a></span><span class="hspace">&nbsp;</span><span class="RktSym">all-stops</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/set_.html#%28form._%28%28quote._~23~25kernel%29._set%21%29%29" class="RktStxLink" data-pltdoc="x">set!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">all-stops</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Flist%29%29" class="RktStxLink" data-pltdoc="x">for/list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">row</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/query-api.html#%28def._%28%28lib._db%2Fbase..rkt%29._query-rows%29%29" class="RktValLink" data-pltdoc="x">query-rows</a></span><span class="hspace">&nbsp;</span><span class="RktSym">connection</span><span class="hspace">&nbsp;</span><a href="#%28elem._%28chunk._~3cstops-select-statement~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stops-select-statement&gt;</a><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._apply%29%29" class="RktValLink" data-pltdoc="x">apply</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._stop%29%29" class="RktValLink" data-pltdoc="x">stop</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector-~3elist%29%29" class="RktValLink" data-pltdoc="x">vector-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">all-stops</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><a name="(elem._(chunk._~3cstops-by-id~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cstops-by-id~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;stops-by-id&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">all-stops-by-id</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._define%2Fpublic%29%29" class="RktStxLink" data-pltdoc="x">define/public</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">stops-by-id</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._when%29%29" class="RktStxLink" data-pltdoc="x">when</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span><span class="hspace">&nbsp;</span><span class="RktSym">all-stops-by-id</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/set_.html#%28form._%28%28quote._~23~25kernel%29._set%21%29%29" class="RktStxLink" data-pltdoc="x">set!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">all-stops-by-id</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._group-stops-by-id%29%29" class="RktValLink" data-pltdoc="x">group-stops-by-id</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/ivaraccess.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._send%29%29" class="RktStxLink" data-pltdoc="x">send</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._this%29%29" class="RktStxLink" data-pltdoc="x">this</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stops</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">all-stops-by-id</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h3>5<tt>&nbsp;</tt><a name="(part._.Route_.Handling)"></a>Route Handling</h3><p><div class="SIntrapara"><a name="(elem._(chunk._~3croute-handling~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3croute-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-handling&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="#%28elem._%28chunk._~3croute-caching~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-caching&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><a href="#%28elem._%28chunk._~3croute-querying~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-querying&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><a href="#%28elem._%28chunk._~3croute-insertion~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-insertion&gt;</a></td></tr></table></blockquote></div></p><h4>5.1<tt>&nbsp;</tt><a name="(part._.Route_.Caching)"></a>Route Caching</h4><ul><li><p>routes may change because of updates</p></li><li><p>provide cache clearing via <span class="RktSym">reset-routes</span></p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3croute-caching~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3croute-caching~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-caching&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">all-routes</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">reset-routes</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/set_.html#%28form._%28%28quote._~23~25kernel%29._set%21%29%29" class="RktStxLink" data-pltdoc="x">set!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">all-routes</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h4>5.2<tt>&nbsp;</tt><a name="(part._.Route_.Querying)"></a>Route Querying</h4><p><div class="SIntrapara"><a name="(elem._(chunk._~3croute-querying~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3croute-querying~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-querying&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="#%28elem._%28chunk._~3call-routes~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;all-routes&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><a href="#%28elem._%28chunk._~3croutes-for-stop~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;routes-for-stop&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><a href="#%28elem._%28chunk._~3croute-exists~3f~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-exists?&gt;</a></td></tr></table></blockquote></div></p><h5>5.2.1<tt>&nbsp;</tt><a name="(part._.Query_.All_.Routes)"></a>Query All Routes</h5><ul><li><p>very similar to <a href="#%28part._query-all-stops%29" data-pltdoc="x">querying all stops</a></p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3call-routes~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3call-routes~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;all-routes&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._define%2Fpublic%29%29" class="RktStxLink" data-pltdoc="x">define/public</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">routes</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._unless%29%29" class="RktStxLink" data-pltdoc="x">unless</a></span><span class="hspace">&nbsp;</span><span class="RktSym">all-routes</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/set_.html#%28form._%28%28quote._~23~25kernel%29._set%21%29%29" class="RktStxLink" data-pltdoc="x">set!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">all-routes</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Flist%29%29" class="RktStxLink" data-pltdoc="x">for/list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">row</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/query-api.html#%28def._%28%28lib._db%2Fbase..rkt%29._query-rows%29%29" class="RktValLink" data-pltdoc="x">query-rows</a></span><span class="hspace">&nbsp;</span><span class="RktSym">connection</span><span class="hspace">&nbsp;</span><span class="RktVal">"select id,number,type,start,end from route"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._apply%29%29" class="RktValLink" data-pltdoc="x">apply</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector-~3elist%29%29" class="RktValLink" data-pltdoc="x">vector-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">all-routes</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h5>5.2.2<tt>&nbsp;</tt><a name="(part._.Routes_for_.Stop)"></a>Routes for Stop</h5><ul><li><p>first query all route ids from the <span style="font-style: italic">mapping</span> table for the given stop-id with the following SQL statement (&rsquo;~a&rsquo; is the placeholder for the id, which is formatted in):</p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3cquery-mapped-routes-statement~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cquery-mapped-routes-statement~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;query-mapped-routes-statement&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktVal">"select * from mapping where stop_id = ~a"</span></p></blockquote></div></p><p><div class="SIntrapara"><a name="(elem._(chunk._~3croutes-for-stop-id~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3croutes-for-stop-id~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;routes-for-stop-id&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._define%2Fpublic%29%29" class="RktStxLink" data-pltdoc="x">define/public</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">routes-for-stop</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._stop-id%29%29" class="RktValLink" data-pltdoc="x">stop-id</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%2A%29%29" class="RktStxLink" data-pltdoc="x">let*</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">statement</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/query-api.html#%28def._%28%28lib._db%2Fbase..rkt%29._virtual-statement%29%29" class="RktValLink" data-pltdoc="x">virtual-statement</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._format%29%29" class="RktValLink" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><a href="#%28elem._%28chunk._~3cquery-mapped-routes-statement~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;query-mapped-routes-statement&gt;</a><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._stop-id%29%29" class="RktValLink" data-pltdoc="x">stop-id</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">route-ids</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Flist%29%29" class="RktStxLink" data-pltdoc="x">for/list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">mapping</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/query-api.html#%28def._%28%28lib._db%2Fbase..rkt%29._query-rows%29%29" class="RktValLink" data-pltdoc="x">query-rows</a></span><span class="hspace">&nbsp;</span><span class="RktSym">connection</span><span class="hspace">&nbsp;</span><span class="RktSym">statement</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/match.html#%28form._%28%28lib._racket%2Fmatch..rkt%29._match-let%29%29" class="RktStxLink" data-pltdoc="x">match-let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector%29%29" class="RktValLink" data-pltdoc="x">vector</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-id%29%29" class="RktValLink" data-pltdoc="x">route-id</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fstxcase-scheme..rkt%29.__%29%29" class="RktStxLink" data-pltdoc="x">_</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">mapping</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-id%29%29" class="RktValLink" data-pltdoc="x">route-id</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._apply%29%29" class="RktValLink" data-pltdoc="x">apply</a></span><span class="hspace">&nbsp;</span><span class="RktSym">routes-for-ids</span><span class="hspace">&nbsp;</span><span class="RktSym">route-ids</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><ul><li><p>then query for all these routes in one step in <span class="RktSym">routes-for-ids</span></p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3croutes-for-stop~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3croutes-for-stop~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;routes-for-stop&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="#%28elem._%28chunk._~3croutes-for-stop-id~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;routes-for-stop-id&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">routes-for-ids</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">ids</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Flist..rkt%29._empty~3f%29%29" class="RktValLink" data-pltdoc="x">empty?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ids</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%2A%29%29" class="RktStxLink" data-pltdoc="x">let*</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">id-list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/strings.html#%28def._%28%28lib._racket%2Fstring..rkt%29._string-join%29%29" class="RktValLink" data-pltdoc="x">string-join</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Fmap..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/strings.html#%28def._%28%28lib._racket%2Fformat..rkt%29._~7ea%29%29" class="RktValLink" data-pltdoc="x">~a</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ids</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">","</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">statement</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/query-api.html#%28def._%28%28lib._db%2Fbase..rkt%29._virtual-statement%29%29" class="RktValLink" data-pltdoc="x">virtual-statement</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._format%29%29" class="RktValLink" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"select * from route where id in (~a)"</span><span class="hspace">&nbsp;</span><span class="RktSym">id-list</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">route-data</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/query-api.html#%28def._%28%28lib._db%2Fbase..rkt%29._query-rows%29%29" class="RktValLink" data-pltdoc="x">query-rows</a></span><span class="hspace">&nbsp;</span><span class="RktSym">connection</span><span class="hspace">&nbsp;</span><span class="RktSym">statement</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Flist%29%29" class="RktStxLink" data-pltdoc="x">for/list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">route-datum</span><span class="hspace">&nbsp;</span><span class="RktSym">route-data</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._apply%29%29" class="RktValLink" data-pltdoc="x">apply</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector-~3elist%29%29" class="RktValLink" data-pltdoc="x">vector-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">route-datum</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h5>5.2.3<tt>&nbsp;</tt><a name="(part._.Does_.Route_.Exist_)"></a>Does Route Exist?</h5><ul><li><p>takes an already created <span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span> struct</p></li><li><p>checks for existence of route with the same data, i.e., ignoring <span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-id%29%29" class="RktValLink" data-pltdoc="x">route-id</a></span></p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3croute-exists~3f~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3croute-exists~3f~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-exists?&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._define%2Fpublic%29%29" class="RktStxLink" data-pltdoc="x">define/public</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">route-exists?</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Flist..rkt%29._findf%29%29" class="RktValLink" data-pltdoc="x">findf</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">existent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-type%29%29" class="RktValLink" data-pltdoc="x">route-type</a></span><span class="hspace">&nbsp;</span><span class="RktSym">existent</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-type%29%29" class="RktValLink" data-pltdoc="x">route-type</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-number%29%29" class="RktValLink" data-pltdoc="x">route-number</a></span><span class="hspace">&nbsp;</span><span class="RktSym">existent</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-number%29%29" class="RktValLink" data-pltdoc="x">route-number</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-start%29%29" class="RktValLink" data-pltdoc="x">route-start</a></span><span class="hspace">&nbsp;</span><span class="RktSym">existent</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-start%29%29" class="RktValLink" data-pltdoc="x">route-start</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-end%29%29" class="RktValLink" data-pltdoc="x">route-end</a></span><span class="hspace">&nbsp;</span><span class="RktSym">existent</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-end%29%29" class="RktValLink" data-pltdoc="x">route-end</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/ivaraccess.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._send%29%29" class="RktStxLink" data-pltdoc="x">send</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._this%29%29" class="RktStxLink" data-pltdoc="x">this</a></span><span class="hspace">&nbsp;</span><span class="RktSym">routes</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#t</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h4>5.3<tt>&nbsp;</tt><a name="(part._.Route_.Insertion)"></a>Route Insertion</h4><ul><li><p>route data is taken from given <span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span> struct (whose <span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-id%29%29" class="RktValLink" data-pltdoc="x">route-id</a></span> is ignored)</p></li><li><p>route insertion is straightforward with a plain SQL statement</p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3croute-insertion-statement~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3croute-insertion-statement~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-insertion-statement&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktVal">"insert into route(number,type,start,end) values('~a','~a','~a','~a')"</span></p></blockquote></div></p><ul><li><p><span class="RktSym">format-route-data</span> helps to put the route&rsquo;s data into the correct SQL statement places:</p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3cformat-route-data~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cformat-route-data~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;format-route-data&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">format-route-data</span><span class="hspace">&nbsp;</span><span class="RktSym">format-string</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._format%29%29" class="RktValLink" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktSym">format-string</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-number%29%29" class="RktValLink" data-pltdoc="x">route-number</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-type%29%29" class="RktValLink" data-pltdoc="x">route-type</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-start%29%29" class="RktValLink" data-pltdoc="x">route-start</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-end%29%29" class="RktValLink" data-pltdoc="x">route-end</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><ul><li><p>after insertion, the routes cache is reset (because we know an update happened)</p></li><li><p>if given, any stops are inserted for the new route</p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3croute-insertion~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3croute-insertion~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-insertion&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._define%2Fpublic%29%29" class="RktStxLink" data-pltdoc="x">define/public</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">insert-route</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">stop-ids</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._null%29%29" class="RktValLink" data-pltdoc="x">null</a></span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._unless%29%29" class="RktStxLink" data-pltdoc="x">unless</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">route-exists?</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">insert-statement</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">format-route-data</span><span class="hspace">&nbsp;</span><a href="#%28elem._%28chunk._~3croute-insertion-statement~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-insertion-statement&gt;</a><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/query-api.html#%28def._%28%28lib._db%2Fbase..rkt%29._query-exec%29%29" class="RktValLink" data-pltdoc="x">query-exec</a></span><span class="hspace">&nbsp;</span><span class="RktSym">connection</span><span class="hspace">&nbsp;</span><span class="RktSym">insert-statement</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">reset-routes</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">insert-route-stops</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stop-ids</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><a href="#%28elem._%28chunk._~3cformat-route-data~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;format-route-data&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><a href="#%28elem._%28chunk._~3cinsert-route-stops~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;insert-route-stops&gt;</a></td></tr></table></blockquote></div></p><h5>5.3.1<tt>&nbsp;</tt><a name="(part._.Stop_.Insertion_for_.Given_.Route)"></a>Stop Insertion for Given Route</h5><ul><li><p>to insert stops we first find out which database id the newly inserted route has:</p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3cget-id-for-route-data-statement~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cget-id-for-route-data-statement~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;get-id-for-route-data-statement&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktVal">"select id from route where number='~a' and type='~a' and start='~a' and end='~a'"</span></p></blockquote></div></p><ul><li><p>then insert (route-id, stop-id) pairs for each given stop-id</p></li><li><p>insertion is done in one statement with all pairs given at once</p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3cinsert-route-stops~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cinsert-route-stops~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;insert-route-stops&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._define%2Fpublic%29%29" class="RktStxLink" data-pltdoc="x">define/public</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">insert-route-stops</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stop-ids</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%2A%29%29" class="RktStxLink" data-pltdoc="x">let*</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">id-statement</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">format-route-data</span><span class="hspace">&nbsp;</span><a href="#%28elem._%28chunk._~3cget-id-for-route-data-statement~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;get-id-for-route-data-statement&gt;</a><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route%29%29" class="RktValLink" data-pltdoc="x">route</a></span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">new-route-id</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/query-api.html#%28def._%28%28lib._db%2Fbase..rkt%29._query-value%29%29" class="RktValLink" data-pltdoc="x">query-value</a></span><span class="hspace">&nbsp;</span><span class="RktSym">connection</span><span class="hspace">&nbsp;</span><span class="RktSym">id-statement</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">id-pairs</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/strings.html#%28def._%28%28lib._racket%2Fstring..rkt%29._string-join%29%29" class="RktValLink" data-pltdoc="x">string-join</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2A%2Flist%29%29" class="RktStxLink" data-pltdoc="x">for*/list</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-id%29%29" class="RktValLink" data-pltdoc="x">route-id</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">new-route-id</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._stop-id%29%29" class="RktValLink" data-pltdoc="x">stop-id</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stop-ids</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._format%29%29" class="RktValLink" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"(~a, ~a)"</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._route-id%29%29" class="RktValLink" data-pltdoc="x">route-id</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="data-defs.html#%28def._%28c~3a~5cdoc~5csrc~5croute21~5csub3~5cdata-defs..rkt._stop-id%29%29" class="RktValLink" data-pltdoc="x">stop-id</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">","</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">insert-statement</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/Writing.html#%28def._%28%28quote._~23~25kernel%29._format%29%29" class="RktValLink" data-pltdoc="x">format</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"insert into mapping(route_id,stop_id) values ~a"</span><span class="hspace">&nbsp;</span><span class="RktSym">id-pairs</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/query-api.html#%28def._%28%28lib._db%2Fbase..rkt%29._query-exec%29%29" class="RktValLink" data-pltdoc="x">query-exec</a></span><span class="hspace">&nbsp;</span><span class="RktSym">connection</span><span class="hspace">&nbsp;</span><span class="RktSym">insert-statement</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h3>6<tt>&nbsp;</tt><a name="(part._.Route_.Update_.Handling)"></a>Route Update Handling</h3><p><div class="SIntrapara"><a name="(elem._(chunk._~3croute-update-handling~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3croute-update-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;route-update-handling&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="#%28elem._%28chunk._~3cchecksum~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;checksum&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><a href="#%28elem._%28chunk._~3ccallback-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;callback-handling&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><a href="#%28elem._%28chunk._~3cperiodic-checksum-checking~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;periodic-checksum-checking&gt;</a></td></tr></table></blockquote></div></p><h4>6.1<tt>&nbsp;</tt><a name="(part._.Table_.Checksum)"></a>Table Checksum</h4><ul><li><p>each MySQL table has a checksum which is updated if the table is modified</p></li><li><p>remember the checksum which corresponds to the currently cached <span class="RktSym">all-routes</span> variable</p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3cchecksum~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cchecksum~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;checksum&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">query-checksum</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../../../../../Users/atw12aq5/AppData/Roaming/Racket/6.11/pkgs/threading-doc/scribblings/doc/threading/index.html#%28form._%28%28lib._threading%2Fmain..rkt%29._~7e~3e%29%29" class="RktStxLink" data-pltdoc="x">~&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/query-api.html#%28def._%28%28lib._db%2Fbase..rkt%29._query-row%29%29" class="RktValLink" data-pltdoc="x">query-row</a></span><span class="hspace">&nbsp;</span><span class="RktSym">connection</span><span class="hspace">&nbsp;</span><span class="RktVal">"checksum table route"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector-ref%29%29" class="RktValLink" data-pltdoc="x">vector-ref</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="../../../../../Users/atw12aq5/AppData/Roaming/Racket/6.11/pkgs/sugar/sugar/doc/sugar/index.html#%28def._%28%28lib._sugar%2Fcoerce..rkt%29._-~3eint%29%29" class="RktValLink" data-pltdoc="x"><span class="nobreak">-&gt;</span>int</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">checksum</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">query-checksum</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h4>6.2<tt>&nbsp;</tt><a name="(part._.Handle_.Callbacks)"></a>Handle Callbacks</h4><ul><li><p>register callback functions into a top-level variable</p></li><li><p><span class="RktSym">invoke-callbacks</span> can be used to notify about updates</p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3ccallback-handling~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3ccallback-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;callback-handling&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">callbacks</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/sets.html#%28def._%28%28lib._racket%2Fset..rkt%29._mutable-set%29%29" class="RktValLink" data-pltdoc="x">mutable-set</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._define%2Fpublic%29%29" class="RktStxLink" data-pltdoc="x">define/public</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add-callback</span><span class="hspace">&nbsp;</span><span class="RktSym">callback</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/sets.html#%28def._%28%28lib._racket%2Fset..rkt%29._set-add%21%29%29" class="RktValLink" data-pltdoc="x">set-add!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">callbacks</span><span class="hspace">&nbsp;</span><span class="RktSym">callback</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">invoke-callbacks</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/sets.html#%28def._%28%28lib._racket%2Fset..rkt%29._set-for-each%29%29" class="RktValLink" data-pltdoc="x">set-for-each</a></span><span class="hspace">&nbsp;</span><span class="RktSym">callbacks</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">callback</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">callback</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h4>6.3<tt>&nbsp;</tt><a name="(part._.Periodic_.Checksum_.Update)"></a>Periodic Checksum Update</h4><ul><li><p>use a periodic timer which queries the current checksum</p></li><li><p><div class="SIntrapara">on changes
</div><div class="SIntrapara"><ul><li><p>update checksum data</p></li><li><p>clear routes cache variable</p></li><li><p>invoke registered callbacks</p></li></ul></div></p></li></ul><p><div class="SIntrapara"><a name="(elem._(chunk._~3cperiodic-checksum-checking~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cperiodic-checksum-checking~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;periodic-checksum-checking&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">timer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/objcreation.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._new%29%29" class="RktStxLink" data-pltdoc="x">new</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://docs.racket-lang.org/gui/timer_.html" class="RktValLink" data-pltdoc="x">timer%</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">interval</span><span class="hspace">&nbsp;</span><span class="RktSym">poll-millisecs</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">notify-callback</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._lambda%29%29" class="RktStxLink" data-pltdoc="x">lambda</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">new-checksum</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">query-checksum</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._unless%29%29" class="RktStxLink" data-pltdoc="x">unless</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">new-checksum</span><span class="hspace">&nbsp;</span><span class="RktSym">checksum</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/set_.html#%28form._%28%28quote._~23~25kernel%29._set%21%29%29" class="RktStxLink" data-pltdoc="x">set!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">checksum</span><span class="hspace">&nbsp;</span><span class="RktSym">new-checksum</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">reset-routes</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">invoke-callbacks</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h3>7<tt>&nbsp;</tt><a name="(part._.Food_.Places)"></a>Food Places</h3><p><div class="SIntrapara"><a name="(elem._(chunk._~3cfood-handling~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3cfood-handling~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;food-handling&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">all-food</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._define%2Fpublic%29%29" class="RktStxLink" data-pltdoc="x">define/public</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">foods</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/when_unless.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._unless%29%29" class="RktStxLink" data-pltdoc="x">unless</a></span><span class="hspace">&nbsp;</span><span class="RktSym">all-food</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/set_.html#%28form._%28%28quote._~23~25kernel%29._set%21%29%29" class="RktStxLink" data-pltdoc="x">set!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">all-food</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Flist%29%29" class="RktStxLink" data-pltdoc="x">for/list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">row</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/db/query-api.html#%28def._%28%28lib._db%2Fbase..rkt%29._query-rows%29%29" class="RktValLink" data-pltdoc="x">query-rows</a></span><span class="hspace">&nbsp;</span><span class="RktSym">connection</span><span class="hspace">&nbsp;</span><span class="RktVal">"select id,lon,lat,name,amenity,website,wheelchair,smoking,cuisine,opening_hours,outdoor_seating from food"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._apply%29%29" class="RktValLink" data-pltdoc="x">apply</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">food</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/vectors.html#%28def._%28%28quote._~23~25kernel%29._vector-~3elist%29%29" class="RktValLink" data-pltdoc="x">vector-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">row</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">all-food</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/createclass.html#%28form._%28%28lib._racket%2Fprivate%2Fclass-internal..rkt%29._define%2Fpublic%29%29" class="RktStxLink" data-pltdoc="x">define/public</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">food-at-place</span><span class="hspace">&nbsp;</span><span class="RktSym">lon</span><span class="hspace">&nbsp;</span><span class="RktSym">lat</span><span class="hspace">&nbsp;</span><span class="RktSym">max-distance</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Flist..rkt%29._sort%29%29" class="RktValLink" data-pltdoc="x">sort</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Flist%29%29" class="RktStxLink" data-pltdoc="x">for/list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">food-info</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Fmap..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._~ce~bb%29%29" class="RktStxLink" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._cons%29%29" class="RktValLink" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">hav:distance-in-meters-deg</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">lon</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lat</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">food-lon</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">food-lat</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">foods</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:when</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._~3c~3d%29%29" class="RktValLink" data-pltdoc="x">&lt;=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._car%29%29" class="RktValLink" data-pltdoc="x">car</a></span><span class="hspace">&nbsp;</span><span class="RktSym">food-info</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">max-distance</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">food-info</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/lambda.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._~ce~bb%29%29" class="RktStxLink" data-pltdoc="x">&#955;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._~3c%29%29" class="RktValLink" data-pltdoc="x">&lt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._car%29%29" class="RktValLink" data-pltdoc="x">car</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._car%29%29" class="RktValLink" data-pltdoc="x">car</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h3>8<tt>&nbsp;</tt><a name="(part._.File_.Structure)"></a>File Structure</h3><p><div class="SIntrapara"><a name="(elem._(chunk._~3c*~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3c%2A~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;*&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="#%28elem._%28chunk._~3crequires~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;requires&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><a href="#%28elem._%28chunk._~3cdb-data-provider~25~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;db-data-provider%&gt;</a></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._provide%29%29" class="RktStxLink" data-pltdoc="x">provide</a></span><span class="hspace">&nbsp;</span><span class="RktSym">db-data-provider%</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><a name="(elem._(chunk._~3crequires~3e~3a1))"></a><span style="font-weight: bold"><span style="font-style: italic"><a href="#%28elem._%28chunk._~3crequires~3e~3a1%29%29" class="plainlink" data-pltdoc="x">&lt;requires&gt;</a></span> ::=</span></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">db</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">setup/getinfo</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/format</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">threading</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">sugar/coerce</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">racket/gui/base</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"data-provider.rkt"</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"data-defs.rkt"</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._prefix-in%29%29" class="RktStxLink" data-pltdoc="x">prefix-in</a></span><span class="hspace">&nbsp;</span><span class="RktSym">hav:</span><span class="hspace">&nbsp;</span><span class="RktVal">"haversine.rkt"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p></div></div><div id="contextindicator">&nbsp;</div></body></html>